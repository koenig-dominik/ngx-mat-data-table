!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/BehaviorSubject"),require("rxjs/observable/merge"),require("rxjs/operators"),require("rxjs/operators/debounceTime"),require("rxjs/operators/distinctUntilChanged"),require("@angular/core"),require("@angular/material"),require("@angular/cdk/collections"),require("rxjs/add/operator/skip"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define(["exports","rxjs/BehaviorSubject","rxjs/observable/merge","rxjs/operators","rxjs/operators/debounceTime","rxjs/operators/distinctUntilChanged","@angular/core","@angular/material","@angular/cdk/collections","rxjs/add/operator/skip","@angular/common","@angular/forms"],t):t(e["ngx-mat-data-table"]={},e.Rx,e.Rx.Observable,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.ng.core,e.ng.material,e.ng.cdk.collections,e.Rx.Observable.prototype,e.ng.common,e.ng.forms)}(this,function(e,c,s,o,i,l,t,n,r,a,u,d){"use strict";function m(t,i,s,l){return new(s||(s=Promise))(function(e,n){function r(e){try{o(l.next(e))}catch(t){n(t)}}function a(e){try{o(l["throw"](e))}catch(t){n(t)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,a)}o((l=l.apply(t,i||[])).next())})}function h(n,r){var a,o,i,e,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(e){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,o&&(i=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(i=i.call(o,e[1])).done)return i;switch(o=0,i&&(e=[0,i.value]),e[0]){case 0:case 1:i=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){s.label=e[1];break}if(6===e[0]&&s.label<i[1]){s.label=i[1],i=e;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(e);break}i[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{a=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)i.push(r.value)}catch(s){a={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(a)throw a.error}}return i}var g=function(){function e(e,t,n,r){void 0===r&&(r=300),this.uniqueKey=e,this.fetchData=t,this.changeData=n,this.debounce=r,this.filter="",this.renderedRowsSubject=new c.BehaviorSubject([]),this.loadingSubject=new c.BehaviorSubject(!1),this.bufferingSubject=new c.BehaviorSubject(!1),this.saveErrorSubject=new c.BehaviorSubject(""),this.rows=new Map,this.rowsViews=new Map,this.savingRows=new Map,this.savingRowsViews=new Map,this.loading=this.loadingSubject.asObservable(),this.buffering=this.bufferingSubject.asObservable(),this.saveError=this.saveErrorSubject.asObservable()}return Object.defineProperty(e.prototype,"renderedRows",{get:function(){return this.renderedRowsSubject.value},enumerable:!0,configurable:!0}),e.prototype.connect=function(e){return this.renderedRowsSubject.asObservable()},e.prototype.disconnect=function(e){this.renderedRowsSubject.complete(),this.loadingSubject.complete(),this.bufferingSubject.complete(),this.saveErrorSubject.complete()},e.prototype.setup=function(e,t,n,r){var a=this;this.paginator=e,this.sort=t,s.merge(n,this.sort.sortChange,this.paginator.page).pipe(o.tap(function(e){"string"==typeof e&&(a.filter=e),a.bufferingSubject.next(!0)}),i.debounceTime(this.debounce),o.tap(function(){a.bufferingSubject.next(!1)}),l.distinctUntilChanged(function(e,t){return e.pageIndex!==undefined?e.pageIndex===t.pageIndex&&e.pageSize===t.pageSize:e.direction!==undefined?e.active===t.active&&e.direction===t.direction:e===t})).subscribe(function(){a.updateCurrentView()}),Promise.resolve().then(function(){a.updateCurrentView()}),r.pipe(i.debounceTime(this.debounce)).subscribe(function(r){return m(a,void 0,void 0,function(){var t,n;return h(this,function(e){switch(e.label){case 0:(t=this.renderedSavingRows[r.rowIndex]).get(r.column).next(!0),e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,this.changeData(r.column,r.values)];case 2:return e.sent(),[3,5];case 3:return n=e.sent(),this.saveErrorSubject.next(n),[3,5];case 4:return t.get(r.column).next(!1),[7];case 5:return[2]}})})})},e.prototype.updateCurrentView=function(){return m(this,void 0,void 0,function(){var t,n,r,a,o,i,s,l;return h(this,function(e){switch(e.label){case 0:return this.currentOffset=this.paginator.pageIndex*this.paginator.pageSize,this.loadingSubject.next(!0),[4,this.fetchData(this.filter,this.sort.active,this.sort.direction,this.currentOffset,this.paginator.pageSize)];case 1:for(t=e.sent(),this.paginator.length=t.count,n=this.filter+";"+this.sort.active+";"+this.sort.direction,!1===this.rowsViews.has(n)&&(this.rowsViews.set(n,[]),this.savingRowsViews.set(n,[])),this.currentView=this.rowsViews.get(n),this.currentSavingRowsView=this.savingRowsViews.get(n),r=0,a=t.items.length;r<a;r++){if(o=t.items[r],i=o[this.uniqueKey],this.rows.has(i))for(l in o)o.hasOwnProperty(l)&&(this.rows.get(i)[l]=o[l]);else this.rows.set(i,o);if(!this.savingRows.has(i)){for(l in s=new Map,o)o.hasOwnProperty(l)&&s.set(l,new c.BehaviorSubject(!1));this.savingRows.set(i,s)}this.currentView[this.currentOffset+r]=this.rows.get(i),this.currentSavingRowsView[this.currentOffset+r]=this.savingRows.get(i)}return this.updateRenderedRows(),this.loadingSubject.next(!1),[2]}})})},e.prototype.updateRenderedRows=function(){this.renderedSavingRows=this.currentSavingRowsView.slice(this.currentOffset,this.currentOffset+this.paginator.pageSize),this.renderedRowsSubject.next(this.currentView.slice(this.currentOffset,this.currentOffset+this.paginator.pageSize))},e}(),f=function(){function e(e){this.snackBar=e,this.displayedColumns=["select"],this.selection=new r.SelectionModel(!0,[]),this.filterChanged=new t.EventEmitter,this.cellChanged=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e,t,n=this;try{for(var r=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(this.columns),a=r.next();!a.done;a=r.next()){var o=a.value;this.displayedColumns.push(o.name)}}catch(i){e={error:i}}finally{try{a&&!a.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}this.dataSource.setup(this.paginator,this.sort,this.filterChanged,this.cellChanged),s.merge(this.sort.sortChange,this.filterChanged).subscribe(function(){return n.paginator.pageIndex=0}),this.dataSource.saveError.skip(1).subscribe(function(e){n.snackBar.open(e,null,{duration:2e3,horizontalPosition:"right",verticalPosition:"bottom"})})},e.prototype.cellChange=function(e,t,n,r){t[e]=n,this.cellChanged.emit({column:e,values:t,rowIndex:r})},e.prototype.filterChange=function(e){this.filter=e.trim().toLowerCase(),this.filterChanged.emit(this.filter)},e.prototype.masterToggle=function(){var e;this.isAllSelected()?this.selection.clear():(e=this.selection).select.apply(e,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}(this.dataSource.renderedRows))},e.prototype.isAllSelected=function(){return this.selection.selected.length===this.dataSource.renderedRows.length},e}();f.decorators=[{type:t.Component,args:[{selector:"ngx-mat-data-table",template:'<mat-card>\n  <mat-card-header>\n    <mat-card-title>{{title}}</mat-card-title>\n    <mat-card-subtitle>\n      <mat-form-field>\n        <input [ngModel]="filter" (ngModelChange)="filterChange($event)" matInput placeholder="Filter">\n      </mat-form-field>\n    </mat-card-subtitle>\n  </mat-card-header>\n  <mat-card-content>\n    <mat-progress-bar [class.show]="(dataSource.loading | async) || (dataSource.buffering | async)" [mode]="(dataSource.buffering | async) ? \'buffer\' : \'indeterminate\'"></mat-progress-bar>\n    <mat-table #table [dataSource]="dataSource"\n               matSort [matSortActive]="sortColumn" matSortDisableClear matSortDirection="asc">\n      \x3c!-- Checkbox Column --\x3e\n      <ng-container matColumnDef="select">\n        <mat-header-cell *matHeaderCellDef>\n          <mat-checkbox (change)="$event ? masterToggle() : null"\n                        [checked]="selection.hasValue() && isAllSelected()"\n                        [indeterminate]="selection.hasValue() && !isAllSelected()">\n          </mat-checkbox>\n        </mat-header-cell>\n        <mat-cell *matCellDef="let row">\n          <mat-checkbox (click)="$event.stopPropagation()"\n                        (change)="$event ? selection.toggle(row) : null"\n                        [checked]="selection.isSelected(row)">\n          </mat-checkbox>\n        </mat-cell>\n      </ng-container>\n      <ng-container *ngFor="let column of columns" [matColumnDef]="column.name">\n        <mat-header-cell mat-sort-header *matHeaderCellDef [style.max-width]="(column.width + 24) + \'px\'">{{column.label}}</mat-header-cell>\n        <mat-cell *matCellDef="let row; let rowIndex = index" [style.max-width]="(column.width + 24) + \'px\'">\n          <ng-container *ngIf="!column.editable; else editable">\n            <ng-container *ngIf="row[column.name].constructor.name !== \'Date\'; else date">\n              {{row[column.name]}}\n            </ng-container>\n            <ng-template #date>\n              {{row[column.name] | date:\'short\'}}\n            </ng-template>\n          </ng-container>\n          <ng-template #editable>\n            <mat-progress-bar [class.show]="dataSource.renderedSavingRows[rowIndex].get(column.name) | async" mode="indeterminate"></mat-progress-bar>\n            <ng-container *ngIf="column.values; else elseIf">\n              <mat-form-field [style.max-width]="column.width + \'px\'">\n                <mat-select [ngModel]="row[column.name]" (ngModelChange)="cellChange(column.name, row, $event, rowIndex)">\n                  <mat-option *ngFor="let value of column.values" [value]="value">\n                    {{ value }}\n                  </mat-option>\n                </mat-select>\n              </mat-form-field>\n            </ng-container>\n            <ng-template #elseIf>\n              <ng-container *ngIf="row[column.name].constructor.name !== \'Date\'; else datepicker">\n                <div class="edit-button" [matMenuTriggerFor]="menu">\n                  {{row[column.name]}}\n                  <mat-icon>edit_mode</mat-icon>\n                </div>\n                <mat-menu #menu="matMenu">\n                  <div mat-menu-item disabled class="full-height-menu-item">\n                    <mat-form-field class="mat-cell" [style.max-width]="column.width + \'px\'"> \x3c!-- mat-cell is a hack to override the disabled state of mat-menu-item --\x3e\n                      <input matInput #message [attr.maxlength]="column.maxLength" [ngModel]="row[column.name]" (ngModelChange)="cellChange(column.name, row, $event, rowIndex)">\n                      <mat-hint align="end">{{message.value.length}} / {{column.maxLength}}</mat-hint>\n                    </mat-form-field>\n                  </div>\n                </mat-menu>\n              </ng-container>\n              <ng-template #datepicker>\n                <mat-form-field [style.max-width]="column.width + \'px\'">\n                  <input matInput [matDatepicker]="picker" [ngModel]="row[column.name]" (ngModelChange)="cellChange(column.name, row, $event, rowIndex)">\n                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>\n                  <mat-datepicker #picker></mat-datepicker>\n                </mat-form-field>\n              </ng-template>\n            </ng-template>\n          </ng-template>\n        </mat-cell>\n      </ng-container>\n      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\n      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\n    </mat-table>\n    <mat-paginator [pageSize]="5"\n                   [pageSizeOptions]="[5, 10, 20]"\n                   [showFirstLastButtons]="true">\n    </mat-paginator>\n  </mat-card-content>\n</mat-card>\n',styles:[":host{display:block}:host ::ng-deep .mat-card{padding:0}:host ::ng-deep .mat-card .mat-card-header{padding-left:24px;padding-right:24px;padding-top:24px}:host ::ng-deep .mat-cell .mat-input-underline{visibility:hidden}:host .mat-progress-bar{opacity:0}:host .mat-progress-bar.show{opacity:1}:host .mat-column-select{max-width:44px;overflow:visible}:host .mat-cell .edit-button{cursor:pointer;line-height:24px;margin-right:24px;padding-top:1.16em;padding-bottom:1.18em}:host .mat-cell .edit-button .mat-icon{float:right}.full-height-menu-item{height:auto;line-height:initial}"]}]}],f.ctorParameters=function(){return[{type:n.MatSnackBar}]},f.propDecorators={title:[{type:t.Input}],columns:[{type:t.Input}],sortColumn:[{type:t.Input}],uniqueColumn:[{type:t.Input}],dataSource:[{type:t.Input}],paginator:[{type:t.ViewChild,args:[n.MatPaginator]}],sort:[{type:t.ViewChild,args:[n.MatSort]}]};var b=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}();b.decorators=[{type:t.NgModule,args:[{imports:[u.CommonModule,n.MatTableModule,n.MatFormFieldModule,n.MatInputModule,n.MatCardModule,n.MatCheckboxModule,n.MatNativeDateModule,n.MatDatepickerModule,n.MatSelectModule,n.MatIconModule,n.MatMenuModule,n.MatPaginatorModule,n.MatSortModule,n.MatProgressBarModule,n.MatSnackBarModule,d.FormsModule],declarations:[f],exports:[f],providers:[]}]}],b.ctorParameters=function(){return[]},e.DataTableModule=b,e.AsyncDataSource=g,e.ɵa=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-mat-data-table.umd.min.js.map
